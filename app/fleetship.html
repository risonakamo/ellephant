<link rel="import" href="polymer/polymer/polymer-element.html">

<dom-module id="fleet-ship">
  <template>
    <style>
      :host
      {
        display: inline-block;
        width: 240px;
        height: 110px;
        margin: 0 10px 10px 0;
        overflow: hidden;
        /*background-color: #e5e5e7;*/
        /*background-color: rgba(255,255,255,.02);*/
        background-color: rgba(50,51,43,.4);
        user-select: none;
        cursor: default;
      }

      div
      {
        display: inline-block;
      }

      #no-data
      {
        position: absolute;
        width: 240px;
        height: 110px;
        font-size: 20px;
        text-align: center;
        line-height: 110px;
        color: #45747a;
        transition: opacity .4s;
      }

      .loaded
      {
        opacity: 0;
      }

      #loaded
      {
        transition: transform .4s;
      }

      .unloaded
      {
        transform: translateY(110px);
      }

      #face
      {
        width: 100px;
        height: 90px;
        background-color: rgba(94,102,104,.2);
        overflow: hidden;
        text-align: center;
      }

      #face img
      {
        height: 100%;
      }

      .detail
      {
        position: relative;
        width: 100px;
        height: 20px;        
        line-height: 20px;
        font-size: 19px;
        color: #020200;
        color: #d2d4d1;
        /*background-color: #d2d4d1;*/
        text-align: center;
      }

      .exp-bar
      {
        position: absolute;
        bottom: 0;
        left: 0;
        height: 0;
        border-bottom: 2px solid #97a9b3;
        transition: width .4s;
      }

      .left
      {
        /*background-color: #d2d4d1;*/
      }

      .side
      {
        display: inline-block;
        vertical-align: top;
        width: 100px;
        height: 110px;
      }

      .right
      {
        /*padding: 3px 0 0 5px;*/
        box-sizing: border-box;
        width: 140px;
      }

      .health
      {            
        width: 50px;
        height: 60px;
        color: #c5c5c5;
        font-size: 0;
        text-align: center;
        margin: 3px 0 0 5px;
      }

      .health div
      {
        display: inline-block;
        vertical-align: top;
      }

      #health-top
      {
        height: 29px;
      }

      .health-slot
      {
        width: 50px;
        height: 35px;
        font-size: 23px;
        text-align: center;
      }

      .border
      {
        width: 70%;
        height: 0;
        border-bottom: 1px solid #c5c5c5;
      }

      .stat-icons
      {
        width: 85px;
        height: 60px;
        vertical-align: top;
      }

      #morale
      {
        width: 100%;
        height: 30px;
        line-height: 30px;
        font-size: 25px;
        color: #f4e1a5;
        text-align: center;
      }

      #morale.low
      {
        color: #ec8a34;
        background-color: rgba(49,8,8,.5);
      }

      #morale.low::before
      {
        content:"✖";
      }

      #morale.high
      {
        background-color: rgba(242,244,188,.1);
      }

      #morale.high::before
      {
        content:"✦";
      }

      .resource
      {
        width: 100%;
        height: 30px;
        text-align: center;
      }

      .res-bar
      {
        width: 65%;
        height: 13px;
        text-align: left;
        border-bottom: 1px solid #83b254;
        box-sizing: border-box;
      }

      .res-bar.top
      {
        height: 12px;
        border-bottom-color: #967844;
      }

      .res-bar-fill
      {
        border-bottom-color: #83b254;
        border-bottom-width: 3px;        
        transition: width .4s;
      }

      .hp-bar
      {
        width: 110px;
        height: 0;
        border-bottom: 8px solid #192325;
      }

      .hp-bar-fill
      {
        border-bottom-color: #5b757e;
        transition: width,color .4s,.4s;
      }

      .hp-bar.red
      {
        border-color: #450000;
      }

      .hp-bar.red .hp-bar-fill
      {
        border-color: #e50014;
      }

      .hp-bar.yellow
      {
        border-color: #564f19;
      }

      .hp-bar.yellow .hp-bar-fill
      {
        border-color: #ffd73f;
      }

      .hp-bar.orange
      {
        border-color: #461101;
      }

      .hp-bar.orange .hp-bar-fill
      {
        border-color: #f16c2b;
      }

      .hp-bar-back
      {
        margin-left: 15px;
        margin-top: 4px;
        transition: color .4s;
      }

      .equipment
      {
        width: 140px;
        height: 35px;
        /*background-color: #e5e5e7;*/
      }

      .equipment-slot
      {
        position: relative;
        width: 35px;
        height: 35px;
      }

      .equipment-slot img
      {
        width: 100%;
      }

      .plane-count
      {
        position: absolute;
        font-size: 20px;
        bottom: 0;
        left: 0;
      }

    </style>

    <div id="no-data">
      NO DATA
    </div>

    <div id="loaded" class="unloaded">
      <div class="side left">
        <div id="face">
          <img src="[[face]]">
        </div>

        <div class="detail">
          [[shipClass]] Lv[[level]]
          <div class="exp-bar" style="width:[[expPercent]]%"></div>          
        </div>
      </div>

      <div class="side right">
        <div class="health">
          <div id="health-top" class="health-slot">[[curHp]]</div>
          <div class="border"></div>
          <div id="health-bot" class="health-slot">[[maxHp]]</div>
        </div>

        <div class="stat-icons">
          <div id="morale" class="morale">[[morale]]</div>
          <div class="resource">
            <div class="res-bar top">
              <div class="res-bar res-bar-fill top" style="width:[[ammoPercent]]%"></div>
            </div>
            <div class="res-bar">
              <div class="res-bar res-bar-fill" style="width:[[gasPercent]]%"></div>
            </div>
          </div>
        </div>

        <div class="hp-bar hp-bar-back">
          <div class="hp-bar hp-bar-fill" style="width:[[hpPercent]]%"></div>
        </div>

        <div id="equipment" class="equipment">
          <div class="equipment-slot"></div>
          <div class="equipment-slot"></div>
          <div class="equipment-slot"></div>
          <div class="equipment-slot"></div>
        </div>
        
      </div>      
    </div>
  </template>

  <script>
    class fleetShip extends Polymer.Element
    {
      static get is()
      {
        return "fleet-ship";
      }

      static get properties()
      {
        return {

        };
      }

      ready()
      {
        super.ready();

        this.loaded=0;
        this.equipmentSlots=this.$["equipment"].querySelectorAll(".equipment-slot");
      }

      //load data object into fleetship
      /*
        fields:
        maxHp
        curHp
        level
        shipClass
        face
        morale
        curAmmo
        maxAmmo
        curGas
        maxGas
        equipment (array of strings)
        maxExp
        curExp
        planeCount (array of numbers direct from api)
        shipId (player api id for external identification)
      */
      loadShip(data)
      {        
        for (var x in data)
        {
          this[x]=data[x];
        }

        // this.maxHp=data.maxHp
        // this.curHp=data.curHp      
        this.hpPercent=(this.curHp/this.maxHp)*100;

        // this.level=data.level;
        // this.shipClass=data.shipClass;
        // this.face=data.face;

        // this.morale=data.morale;
        
        // this.curAmmo=data.curAmmo;
        // this.maxAmmo=data.maxAmmo;
        this.ammoPercent=(this.curAmmo/this.maxAmmo)*100;

        // this.curGas=data.curGas;
        // this.maxGas=data.maxGas;
        this.gasPercent=(this.curGas/this.maxGas)*100;

        this.expPercent=((this.maxExp-this.curExp)/this.maxExp)*100;

        this.loadEquipment(data.equipment);

        this.applyColour();

        this.loaded=1;
        this.$["loaded"].classList.remove("unloaded");
        this.$["no-data"].classList.add("loaded");
      }      

      loadEquipment(data)
      {
        for (var x=0;x<4;x++)
        {
          var html;

          if (data[x]=="")
          {
            html="";
          }

          else
          {
            html=`<img src="${data[x]}">`;

            if (this.planeCount[x]>0)
            {
              html+=`<div class="plane-count">${this.planeCount[x]}</div>`;
            }
          }

          this.equipmentSlots[x].innerHTML=html;
        }
      }

      applyColour()
      {
        if (this.morale>49)
        {
          this.$["morale"].classList.remove("low");
          this.$["morale"].classList.add("high");
        }

        else if (this.morale<40)
        {
          this.$["morale"].classList.remove("high");
          this.$["morale"].classList.add("low");
        }

        else
        {
          this.$["morale"].classList.remove("low","high");
        }        
      }

      unload()
      {
        this.loaded=0;
        this.$["no-data"].classList.remove("loaded");
        this.$["loaded"].classList.add("unloaded");
      }
    }

    customElements.define(fleetShip.is,fleetShip);
  </script>
</dom-module>